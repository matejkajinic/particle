<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Colorful Particle System Simulation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; }
    </style>
</head>
<body>
    <script>
        let particles = [];
        let attractors = [];

        function setup() {
            createCanvas(windowWidth, windowHeight);
            for (let i = 0; i < 3; i++) {
                attractors.push(createVector(random(width), random(height)));
            }
        }

        function draw() {
            background(0, 25);

            // Update attractors
            for (let i = 0; i < attractors.length; i++) {
                attractors[i].x = noise(frameCount * 0.01 + i * 1000) * width;
                attractors[i].y = noise(frameCount * 0.01 + i * 2000) * height;
                fill(255, 100);
                ellipse(attractors[i].x, attractors[i].y, 20, 20);
            }

            // Create new particles
            if (frameCount % 2 == 0) {
                particles.push(new Particle(random(width), random(height)));
            }

            // Update and display particles
            for (let i = particles.length - 1; i >= 0; i--) {
                particles[i].update();
                particles[i].display();
                if (particles[i].isDead()) {
                    particles.splice(i, 1);
                }
            }

            // Display particle count
            fill(255);
            textSize(16);
            text(`Particles: ${particles.length}`, 10, 20);
        }

        class Particle {
            constructor(x, y) {
                this.pos = createVector(x, y);
                this.vel = p5.Vector.random2D().mult(random(2, 5));
                this.acc = createVector(0, 0);
                this.color = color(random(255), random(255), random(255));
                this.size = random(2, 8);
                this.maxSpeed = 5;
                this.lifespan = 255;
            }

            update() {
                this.acc.mult(0);
                for (let attractor of attractors) {
                    let force = p5.Vector.sub(attractor, this.pos);
                    let d = force.mag();
                    d = constrain(d, 5, 25);
                    let G = 1;
                    force.setMag(G / (d * d));
                    this.acc.add(force);
                }

                this.vel.add(this.acc);
                this.vel.limit(this.maxSpeed);
                this.pos.add(this.vel);
                this.lifespan -= 2;

                // Wrap around edges
                this.pos.x = (this.pos.x + width) % width;
                this.pos.y = (this.pos.y + height) % height;
            }

            display() {
                noStroke();
                fill(red(this.color), green(this.color), blue(this.color), this.lifespan);
                ellipse(this.pos.x, this.pos.y, this.size);
            }

            isDead() {
                return this.lifespan < 0;
            }
        }

        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
        }

        function mouseDragged() {
            particles.push(new Particle(mouseX, mouseY));
        }
    </script>
</body>
</html>
